# 一、使用
go标准库提供了用于测试程序性能的包，下面使用一个简单的案例代码，演示一下性能测试的使用

main_test.go
```golang
package main

import (
	"strings"
	"testing"
)

func str1() {
	str := ""
	for i := 0; i < 10000; i++ {
		str += "abc"
	}
}

func str2() {
	var buf strings.Builder
	for i := 0; i < 10000; i++ {
		buf.WriteString("abs")
	}
}

func BenchmarkStr1(b *testing.B) {
	for i := 0; i < b.N; i++ {
		str1()
	}
}

func BenchmarkStr2(b *testing.B) {
	for i := 0; i < b.N; i++ {
		str2()
	}
}
```

执行命令：`go test -bench=.`

```go
goos: linux
goarch: amd64
cpu: 处理器信息
BenchmarkStr1-4               39          28057110 ns/op
BenchmarkStr2-4            24841             52378 ns/op
PASS
ok      路径        2.920s
```
通过输出可以直观看出，BenchmarkStr1执行了39次，平均每次28057110纳秒，BenchmarkStr2执行了24841次，平均每次52378纳秒


性能测试需要遵守以下规则
* 文件名：必须以 "_test.go" 结尾
* 函数名：必须以 "BenchmarkXxx" 开始
* 执行命令："go test -bench=."
# 二、源码分析
### 1. 数据结构
性能测试的数据结构是testing.B，它与testing.T有一个公共的数据结构common，这个common里面负责记录日志，状态等相关信息

src/testing/benchmark.go下type B struct