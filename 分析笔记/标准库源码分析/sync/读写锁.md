# 1、基本内容

* 上写锁成功，只能由拥有锁的才能进行操作
* 上读锁成功，可以进行读，不能获取到写锁

# 2、源码分析
### 1. 数据结构
```go
type RWMutex struct {
	w           Mutex  // 如果有待处理的写，则保留。
	writerSem   uint32 // 写等待 读完成的信号。
	readerSem   uint32 // 读等待 写完成的信号。
	readerCount int32  // 待处理的读数量
	readerWait  int32  // 离开的读数量
}
```
### 2. 创建读写锁
```go
sync.RWMutex
```
这个包没有提供创建读写锁的包，但是有 读写锁 这个数据结构，可以直接以类型的方式创建读写锁变量
### 3. 上写锁
步骤：
1. 通过互斥锁，保证只有一个协程获取读锁，其他尝试获取写锁的协程都会被阻塞，直到这个获取互斥锁的协程释放这个锁
2. 阻止想获取读锁的协程
3. 等待拥有读锁的协程都释放读锁
4. 获取写锁成功
### 4. 释放写锁
步骤：
1. 允许 尝试获取读锁的协程 去获取读锁
2. 释放 互斥锁
### 5. 上读锁
步骤：
1. 尝试获取读锁，获取不成功（写锁已经被获取）的话，会被阻塞
2. 当前读锁数量加一
3. 获取读锁成功
### 6. 释放读锁
步骤：
1. 当前读锁数量减去一
2. 释放读锁成功