# 一、时间堆
### 1、数据结构
```go
// runtime/runtime2.go
type p struct {
    timersLock mutex
    timers []*timer
    timer0When uint64
    numTimers uint32
}
```
* P.timersLock：定时器锁，保护P.times字段
* P.timers：时间堆，存放了绑定在P上的定时器列表，必须持有timersLock才能访问
* P.timer0When：最先触发的定时器的when绑定在P上的timer0When字段上，如果这个字段的值是0，表示这个定时器堆是空的，这个字段是用原子操作进行修改的
* P.numTimers：P的堆中定时器数量，这个字段是通过原子操作进行修改的

### 2、定时器
```go
// time/tick.go
type Ticker struct {
	// 用于传输时间的通道
	C <-chan Time // The channel on which the ticks are delivered.
	r runtimeTimer
}

// /runtime/time.go
type runtimeTimer struct {
    /*
        该定时器所绑定的p
    */
    pp       uintptr
    /*
        定时器触发时间
    */
    when     int64
    period   int64
    /*
        定时器触发的时候，要执行的函数
    */
    f        func(interface{}, uintptr) // NOTE: must not be closure	// 注意：不得关闭
    /*
        传入f中的第一个参数，分析源码，一般是chan Time
    */
    arg      interface{}
    seq      uintptr
    nextwhen int64
    status   uint32
}
```

